name: Verify Attestation

on:
  workflow_call:

jobs:
  verify-attestation:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
    steps:
    - name: Download attestation
      uses: actions/download-artifact@v4
      with:
        name: attestation.json

    - name: Verify attestation
      id: verification
      uses: kipz/url-oracle@1b410f30a94578d533176de76b9326e345511325
      with:
        command: verify_attestation
        attestation_file: /github/workspace/attestation.json
        commit_sha: 1b410f30a94578d533176de76b9326e345511325

    - name: Comment on commit (if possible)
      run: |
        echo "üîç Verification completed for commit 8e7535bfa0b3b77ce1afe1902d8ff1407cfcf8a8
        echo "üìã Summary: Attestation verified successfully"
